# 电信CRM客户中心 - 关键业务活动图（泳道图）

## 一、概述

业务活动图（Activity Diagram）使用泳道图（Swimlane Diagram）的方式展示跨角色、跨系统的业务流程。本文档描述客户中心的关键业务场景。

## 二、完整开户流程

### 2.1 个人客户开户办理手机号码业务

这是最常见的业务场景，占日常业务量的60%以上。

```
┌─────────────┬──────────────┬──────────────┬──────────────┬──────────────┐
│   客户      │  营业员      │  客户中心    │  产商品中心  │   开通中心   │
└─────────────┴──────────────┴──────────────┴──────────────┴──────────────┘
      │              │              │              │              │
      │ 1.到营业厅    │              │              │              │
      │  办理业务     │              │              │              │
      ├─────────────►│              │              │              │
      │              │              │              │              │
      │              │ 2.验证客户   │              │              │
      │              │  身份证件    │              │              │
      │              ├─────────────►│              │              │
      │              │              │              │              │
      │              │              │ 3.调用       │              │
      │              │              │  实名认证    │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │              │              │
      │              │              │ 4.检查       │              │
      │              │              │  一证五户    │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │              │              │
      │              │◄─────────────┤              │              │
      │              │  认证通过     │              │              │
      │              │              │              │              │
      │ 5.填写客户   │              │              │              │
      │  基本信息    │              │              │              │
      │◄─────────────┤              │              │              │
      │              │              │              │              │
      ├─────────────►│              │              │              │
      │  提交信息     │              │              │              │
      │              │              │              │              │
      │              │ 6.创建客户   │              │              │
      │              ├─────────────►│              │              │
      │              │              │              │              │
      │              │              │ 7.生成       │              │
      │              │              │  客户ID      │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │              │              │
      │              │              │ 8.保存客户   │              │
      │              │              │  档案        │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │              │              │
      │              │◄─────────────┤              │              │
      │              │  客户创建成功 │              │              │
      │              │              │              │              │
      │ 9.选择号码   │              │              │              │
      │◄─────────────┤              │              │              │
      │              │              │              │              │
      ├─────────────►│              │              │              │
      │  确认号码     │              │              │              │
      │              │              │              │              │
      │              │ 10.查询号码  │              │              │
      │              │  可用性      │              │              │
      │              ├─────────────►│              │              │
      │              │              │              │              │
      │              │◄─────────────┤              │              │
      │              │  号码可用     │              │              │
      │              │              │              │              │
      │ 11.选择套餐  │              │              │              │
      │◄─────────────┤              │              │              │
      │              │              │              │              │
      ├─────────────►│              │              │              │
      │  确认套餐     │              │              │              │
      │              │              │              │              │
      │              │ 12.查询套餐  │              │              │
      │              │  信息        │              │              │
      │              ├──────────────┼─────────────►│              │
      │              │              │              │              │
      │              │◄─────────────┼──────────────┤              │
      │              │  套餐信息     │              │              │
      │              │              │              │              │
      │ 13.选择SIM卡 │              │              │              │
      │◄─────────────┤              │              │              │
      │              │              │              │              │
      ├─────────────►│              │              │              │
      │  确认卡类型   │              │              │              │
      │              │              │              │              │
      │              │ 14.创建用户  │              │              │
      │              ├─────────────►│              │              │
      │              │              │              │              │
      │              │              │ 15.生成      │              │
      │              │              │  用户ID      │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │              │              │
      │              │              │ 16.保存用户  │              │
      │              │              │  信息        │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │              │              │
      │              │              │ 17.调用开通  │              │
      │              │              │  中心        │              │
      │              │              ├──────────────┼─────────────►│
      │              │              │              │              │
      │              │              │              │              │ 18.开通网络
      │              │              │              │              │  资源
      │              │              │              │              ├───────┐
      │              │              │              │              │       │
      │              │              │              │              │◄──────┘
      │              │              │              │              │
      │              │              │              │              │ 19.写入HLR
      │              │              │              │              ├───────┐
      │              │              │              │              │       │
      │              │              │              │              │◄──────┘
      │              │              │              │              │
      │              │              │◄─────────────┼──────────────┤
      │              │              │  开通成功     │              │
      │              │              │              │              │
      │              │◄─────────────┤              │              │
      │              │  用户创建成功 │              │              │
      │              │              │              │              │
      │              │ 20.创建账户  │              │              │
      │              ├─────────────►│              │              │
      │              │              │              │              │
      │              │◄─────────────┤              │              │
      │              │  账户创建成功 │              │              │
      │              │              │              │              │
      │              │ 21.绑定用户  │              │              │
      │              │  到账户      │              │              │
      │              ├─────────────►│              │              │
      │              │              │              │              │
      │              │◄─────────────┤              │              │
      │              │  绑定成功     │              │              │
      │              │              │              │              │
      │ 22.充值      │              │              │              │
      │◄─────────────┤              │              │              │
      │              │              │              │              │
      ├─────────────►│              │              │              │
      │  支付100元   │              │              │              │
      │              │              │              │              │
      │              │ 23.账户充值  │              │              │
      │              ├─────────────►│              │              │
      │              │              │              │              │
      │              │◄─────────────┤              │              │
      │              │  充值成功     │              │              │
      │              │              │              │              │
      │              │ 24.交付SIM卡 │              │              │
      │◄─────────────┤              │              │              │
      │              │              │              │              │
      │ 25.插卡开机  │              │              │              │
      ├───────┐      │              │              │              │
      │       │      │              │              │              │
      │◄──────┘      │              │              │              │
      │              │              │              │              │
      │              │              │ 26.检测到    │              │
      │              │              │  激活信号    │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │              │              │
      │              │              │ 27.用户激活  │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │              │              │
      │ 28.接收短信  │              │              │              │
      │  "激活成功"  │              │              │              │
      │◄─────────────┼──────────────┤              │              │
      │              │              │              │              │
      │ 29.开始使用  │              │              │              │
      ├───────┐      │              │              │              │
      │       │      │              │              │              │
      │◄──────┘      │              │              │              │
      │              │              │              │              │
```

### 2.2 流程说明

**参与角色：**
- 客户：服务的购买者和使用者
- 营业员：协助办理业务
- 客户中心：核心业务系统
- 产商品中心：提供产品信息
- 开通中心：执行网络开通

**关键步骤：**
1. **实名认证**（步骤2-4）：验证身份，检查一证五户限制
2. **客户开户**（步骤5-8）：创建客户档案
3. **号码选择**（步骤9-10）：选号并验证可用性
4. **套餐选择**（步骤11-12）：选择资费套餐
5. **用户开户**（步骤13-19）：创建用户，调用开通中心
6. **账户处理**（步骤20-23）：创建账户，绑定用户，充值
7. **交付激活**（步骤24-29）：交付SIM卡，客户激活

**业务规则：**
- 必须先完成实名认证
- 必须先创建客户才能创建用户
- 必须先创建账户并绑定才能使用
- 预付费账户需要先充值
- 开通中心必须成功才能完成开户

**异常处理：**
- 实名认证失败 → 拒绝开户
- 超出一证五户 → 拒绝开户
- 号码不可用 → 重新选号
- 网络开通失败 → 回滚用户创建

## 三、套餐变更流程

### 3.1 用户变更套餐（次月生效）

```
┌─────────────┬──────────────┬──────────────┬──────────────┐
│   客户      │  客户中心    │  产商品中心  │   计费中心   │
└─────────────┴──────────────┴──────────────┴──────────────┘
      │              │              │              │
      │ 1.登录系统   │              │              │
      │  查询套餐    │              │              │
      ├─────────────►│              │              │
      │              │              │              │
      │              │ 2.查询可用   │              │
      │              │  套餐列表    │              │
      │              ├─────────────►│              │
      │              │              │              │
      │              │◄─────────────┤              │
      │              │  套餐列表     │              │
      │              │              │              │
      │◄─────────────┤              │              │
      │  展示套餐     │              │              │
      │              │              │              │
      │ 3.选择新套餐 │              │              │
      ├─────────────►│              │              │
      │              │              │              │
      │              │ 4.查询套餐   │              │
      │              │  详情        │              │
      │              ├─────────────►│              │
      │              │              │              │
      │              │◄─────────────┤              │
      │              │  套餐详情     │              │
      │              │              │              │
      │              │ 5.检查套餐   │              │
      │              │  变更规则    │              │
      │              ├───────┐      │              │
      │              │       │      │              │
      │              │◄──────┘      │              │
      │              │  - 互斥检查   │              │
      │              │  - 依赖检查   │              │
      │              │              │              │
      │ 6.选择生效   │              │              │
      │  时间        │              │              │
      │◄─────────────┤              │              │
      │  [立即/次月] │              │              │
      │              │              │              │
      ├─────────────►│              │              │
      │  选择"次月"  │              │              │
      │              │              │              │
      │              │ 7.计算套餐   │              │
      │              │  差价        │              │
      │              ├──────────────┼─────────────►│
      │              │              │              │
      │              │◄─────────────┼──────────────┤
      │              │  差价为0     │              │
      │              │  (次月生效)   │              │
      │              │              │              │
      │ 8.确认变更   │              │              │
      │◄─────────────┤              │              │
      │              │              │              │
      ├─────────────►│              │              │
      │  确认         │              │              │
      │              │              │              │
      │              │ 9.创建套餐   │              │
      │              │  变更记录    │              │
      │              ├───────┐      │              │
      │              │       │      │              │
      │              │◄──────┘      │              │
      │              │              │              │
      │              │ 10.设置生效  │              │
      │              │  时间        │              │
      │              │  (次月1日)   │              │
      │              ├───────┐      │              │
      │              │       │      │              │
      │              │◄──────┘      │              │
      │              │              │              │
      │              │ 11.发布事件  │              │
      │              │  PackageChanged │           │
      │              ├───────┐      │              │
      │              │       │      │              │
      │              │◄──────┘      │              │
      │              │              │              │
      │◄─────────────┤              │              │
      │  变更成功     │              │              │
      │  次月1日生效  │              │              │
      │              │              │              │
      │              │ [等待到次月1日]             │
      │              │              │              │
      │              │ 12.定时任务  │              │
      │              │  检测        │              │
      │              ├───────┐      │              │
      │              │       │      │              │
      │              │◄──────┘      │              │
      │              │              │              │
      │              │ 13.执行套餐  │              │
      │              │  变更        │              │
      │              ├───────┐      │              │
      │              │       │      │              │
      │              │◄──────┘      │              │
      │              │              │              │
      │              │ 14.通知计费  │              │
      │              │  中心        │              │
      │              ├──────────────┼─────────────►│
      │              │              │              │
      │              │◄─────────────┼──────────────┤
      │              │  确认收到     │              │
      │              │              │              │
      │ 15.接收短信  │              │              │
      │  "套餐已生效"│              │              │
      │◄─────────────┤              │              │
      │              │              │              │
```

### 3.2 流程说明

**参与角色：**
- 客户：发起套餐变更
- 客户中心：处理变更逻辑
- 产商品中心：提供套餐信息
- 计费中心：处理计费变更

**关键步骤：**
1. **查询套餐**（步骤1-2）：查询可用套餐列表
2. **规则检查**（步骤3-5）：检查套餐互斥和依赖关系
3. **选择生效时间**（步骤6）：立即生效或次月生效
4. **计算差价**（步骤7）：次月生效无需补差，立即生效需要计算
5. **执行变更**（步骤9-11）：创建变更记录，设置生效时间
6. **定时生效**（步骤12-14）：到期自动执行变更

**业务规则：**
- 互斥套餐不能同时订购
- 依赖套餐必须先订购
- 立即生效需要计算补差费
- 次月生效从下月1日零时生效

## 四、欠费停机复机流程

### 4.1 欠费停机和复机

```
┌─────────────┬──────────────┬──────────────┬──────────────┬──────────────┐
│   用户      │  客户中心    │  账户管理    │  计费中心    │  开通中心    │
└─────────────┴──────────────┴──────────────┴──────────────┴──────────────┘
      │              │              │              │              │
      │ 1.正常使用   │              │              │              │
      ├───────┐      │              │              │              │
      │       │      │              │              │              │
      │◄──────┘      │              │              │              │
      │              │              │              │              │
      │              │              │ 2.每日计费   │              │
      │              │              │◄─────────────┤              │
      │              │              │  扣费请求     │              │
      │              │              │              │              │
      │              │              │ 3.检查余额   │              │
      │              │              ├───────┐      │              │
      │              │              │       │      │              │
      │              │              │◄──────┘      │              │
      │              │              │  余额不足！   │              │
      │              │              │              │              │
      │              │              │ 4.发送余额   │              │
      │              │              │  不足事件    │              │
      │              │◄─────────────┤              │              │
      │              │              │              │              │
      │              │ 5.记录欠费   │              │              │
      │              ├───────┐      │              │              │
      │              │       │      │              │              │
      │              │◄──────┘      │              │              │
      │              │              │              │              │
      │              │ 6.发送欠费   │              │              │
      │              │  提醒        │              │              │
      │─────────────►│              │              │              │
      │  收到短信     │              │              │              │
      │  "余额不足"  │              │              │              │
      │              │              │              │              │
      │              │ [等待7天]    │              │              │
      │              │              │              │              │
      │              │ 7.定时检查   │              │              │
      │              │  欠费时长    │              │              │
      │              ├───────┐      │              │              │
      │              │       │      │              │              │
      │              │◄──────┘      │              │              │
      │              │  欠费超7天！  │              │              │
      │              │              │              │              │
      │              │ 8.用户停机   │              │              │
      │              ├───────┐      │              │              │
      │              │       │      │              │              │
      │              │◄──────┘      │              │              │
      │              │              │              │              │
      │              │ 9.通知开通   │              │              │
      │              │  中心停机    │              │              │
      │              ├──────────────┼──────────────┼─────────────►│
      │              │              │              │              │
      │              │              │              │              │ 10.停机操作
      │              │              │              │              ├───────┐
      │              │              │              │              │       │
      │              │              │              │              │◄──────┘
      │              │              │              │              │
      │              │◄─────────────┼──────────────┼──────────────┤
      │              │  停机完成     │              │              │
      │              │              │              │              │
      │ 11.接收短信  │              │              │              │
      │  "已停机"    │              │              │              │
      │◄─────────────┤              │              │              │
      │              │              │              │              │
      │ 12.无法使用  │              │              │              │
      │  (打不出)    │              │              │              │
      ├───────┐      │              │              │              │
      │       │      │              │              │              │
      │◄──────┘      │              │              │              │
      │              │              │              │              │
      │              │              │              │              │
      │ 13.充值100元 │              │              │              │
      ├─────────────►│              │              │              │
      │              │              │              │              │
      │              │ 14.账户充值  │              │              │
      │              ├──────────────►│              │              │
      │              │              │              │              │
      │              │◄──────────────┤              │              │
      │              │  充值成功     │              │              │
      │              │              │              │              │
      │              │ 15.检查欠费   │              │              │
      │              │  是否结清     │              │              │
      │              ├──────────────►│              │              │
      │              │              │              │              │
      │              │◄──────────────┤              │              │
      │              │  欠费已结清   │              │              │
      │              │              │              │              │
      │              │ 16.用户复机  │              │              │
      │              ├───────┐      │              │              │
      │              │       │      │              │              │
      │              │◄──────┘      │              │              │
      │              │              │              │              │
      │              │ 17.通知开通  │              │              │
      │              │  中心复机    │              │              │
      │              ├──────────────┼──────────────┼─────────────►│
      │              │              │              │              │
      │              │              │              │              │ 18.复机操作
      │              │              │              │              ├───────┐
      │              │              │              │              │       │
      │              │              │              │              │◄──────┘
      │              │              │              │              │
      │              │◄─────────────┼──────────────┼──────────────┤
      │              │  复机完成     │              │              │
      │              │              │              │              │
      │ 19.接收短信  │              │              │              │
      │  "已复机"    │              │              │              │
      │◄─────────────┤              │              │              │
      │              │              │              │              │
      │ 20.恢复使用  │              │              │              │
      ├───────┐      │              │              │              │
      │       │      │              │              │              │
      │◄──────┘      │              │              │              │
      │              │              │              │              │
```

### 4.2 流程说明

**参与角色：**
- 用户：使用服务
- 客户中心：管理用户状态
- 账户管理：处理账户余额
- 计费中心：发起扣费
- 开通中心：执行停复机

**关键步骤：**
1. **余额不足**（步骤2-3）：计费扣费时发现余额不足
2. **欠费提醒**（步骤4-6）：发送欠费提醒短信
3. **自动停机**（步骤7-10）：欠费7天后自动停机
4. **充值复机**（步骤13-19）：充值后自动复机

**业务规则：**
- 欠费7天后自动停机
- 停机期间不计月租费
- 充值后自动检查是否可以复机
- 欠费结清后立即复机

## 五、用户过户流程

### 5.1 用户过户（归属客户变更）

```
┌─────────────┬──────────────┬──────────────┬──────────────┐
│  原客户     │  新客户      │  客户中心    │  账户管理    │
└─────────────┴──────────────┴──────────────┴──────────────┘
      │              │              │              │
      │ 1.申请过户   │              │              │
      ├─────────────►│              │              │
      │  线下沟通     │              │              │
      │              │              │              │
      │ 2.到营业厅   │ 3.到营业厅   │              │
      │  办理过户     │  办理过户     │              │
      ├──────────────┼─────────────►│              │
      │              │              │              │
      │              │              │ 4.验证原客户 │
      │              │              │  身份        │
      │◄─────────────┼──────────────┤              │
      │  提供证件     │              │              │
      │              │              │              │
      ├──────────────┼─────────────►│              │
      │              │              │              │
      │              │              │ 5.验证新客户 │
      │              │              │  身份        │
      │              │◄─────────────┤              │
      │              │  提供证件     │              │
      │              │              │              │
      │              ├─────────────►│              │
      │              │              │              │
      │              │              │ 6.检查用户   │
      │              │              │  状态        │
      │              │              ├───────┐      │
      │              │              │       │      │
      │              │              │◄──────┘      │
      │              │              │  用户正常     │
      │              │              │              │
      │              │              │ 7.检查欠费   │
      │              │              ├──────────────►│
      │              │              │              │
      │              │              │◄──────────────┤
      │              │              │  无欠费       │
      │              │              │              │
      │              │              │ 8.检查新客户 │
      │              │              │  用户数限制   │
      │              │              ├───────┐      │
      │              │              │       │      │
      │              │              │◄──────┘      │
      │              │              │  未超限       │
      │              │              │              │
      │ 9.确认过户   │              │              │
      │◄─────────────┼──────────────┤              │
      │              │              │              │
      ├──────────────┼─────────────►│              │
      │  签字确认     │              │              │
      │              │              │              │
      │              │ 10.确认接收  │              │
      │              │◄─────────────┤              │
      │              │              │              │
      │              ├─────────────►│              │
      │              │  签字确认     │              │
      │              │              │              │
      │              │              │ 11.执行过户  │
      │              │              ├───────┐      │
      │              │              │       │      │
      │              │              │◄──────┘      │
      │              │              │              │
      │              │              │ 12.更新用户  │
      │              │              │  归属客户    │
      │              │              ├───────┐      │
      │              │              │       │      │
      │              │              │◄──────┘      │
      │              │              │              │
      │              │              │ 13.处理账户  │
      │              │              │  关联        │
      │              │              ├──────────────►│
      │              │              │              │
      │              │              │◄──────────────┤
      │              │              │  账户处理完成 │
      │              │              │              │
      │              │              │ 14.发布过户  │
      │              │              │  事件        │
      │              │              ├───────┐      │
      │              │              │       │      │
      │              │              │◄──────┘      │
      │              │              │              │
      │◄─────────────┼──────────────┤              │
      │  过户完成     │              │              │
      │              │              │              │
      │              │◄─────────────┤              │
      │              │  过户完成     │              │
      │              │              │              │
      │ 15.不再承担  │ 16.开始承担  │              │
      │  费用        │  费用        │              │
      ├───────┐      ├───────┐      │              │
      │       │      │       │      │              │
      │◄──────┘      │◄──────┘      │              │
      │              │              │              │
```

### 5.2 流程说明

**参与角色：**
- 原客户：转出用户的客户
- 新客户：接收用户的客户
- 客户中心：处理过户逻辑
- 账户管理：处理账户关联

**关键步骤：**
1. **双方身份验证**（步骤4-5）：验证双方客户身份
2. **状态检查**（步骤6-8）：检查用户状态、欠费、限制
3. **双方确认**（步骤9-10）：双方签字确认过户
4. **执行过户**（步骤11-13）：更新用户归属，处理账户

**业务规则：**
- 必须双方到场并签字确认
- 用户必须无欠费
- 新客户不能超出用户数限制
- 过户后费用由新客户承担

## 六、总结

本文档描述了客户中心的4个关键业务流程：

1. **完整开户流程**：最复杂的流程，涉及5个角色，29个步骤
2. **套餐变更流程**：高频业务场景，支持立即和次月生效
3. **欠费停复机流程**：自动化流程，体现状态机转换
4. **用户过户流程**：复杂业务协同，需要双方确认

**设计要点：**
- **泳道清晰**：明确每个角色的职责
- **流程完整**：覆盖正常和异常场景
- **解耦设计**：通过事件和API调用实现松耦合
- **自动化**：定时任务处理延迟生效的业务

这些流程图是系统实现的重要参考，确保业务逻辑的正确性和完整性。
