# 电信CRM客户中心 - 子域划分与限界上下文

## 一、业务域分析

### 1.1 核心域（Core Domain）
客户中心作为电信CRM的核心域，是企业的核心竞争力所在，直接面向最终用户提供服务。

### 1.2 支撑域（Supporting Domain）
- 订单中心：处理业务订单流程
- 产商品中心：管理产品和商品信息
- 开通中心：负责服务开通和配置
- 计费中心：处理费用计算和账单

### 1.3 通用域（Generic Domain）
- 认证授权服务
- 消息通知服务
- 日志审计服务
- 配置管理服务

## 二、客户中心子域划分

基于DDD方法论和业务特点，将客户中心划分为以下子域：

### 2.1 客户管理子域（Customer Management Subdomain）
**核心职责：** 管理客户生命周期，包括客户档案、客户类型、客户关系等

**关键业务能力：**
- 客户开户（公众客户、家庭客户、政企客户）
- 客户资料管理与变更
- 客户销户处理
- 客户等级管理
- 客户关系管理（如家庭成员关系、企业组织架构）

**业务规则：**
- 客户唯一标识：客户ID全局唯一
- 客户类型约束：不同类型客户有不同的资料要求
- 实名制要求：客户必须完成实名认证
- 客户状态流转：正常→欠费→停机→销户

### 2.2 用户管理子域（User Management Subdomain）
**核心职责：** 管理用户（号码）的全生命周期，是业务办理的核心载体

**关键业务能力：**
- 个人用户开户（占比90%以上的高频操作）
- 群用户开户（家庭用户、政企集团用户）
- 用户状态变更（开机、停机、预销户、销户）
- 资费调整与套餐变更
- 换卡业务（SIM卡更换）
- 过户业务（用户归属客户变更）
- 号码保留与回收

**业务规则：**
- 用户号码唯一性
- 用户必须归属于某个客户
- 用户状态机严格流转
- 单客户多用户限制（根据客户等级）
- 套餐生效规则（立即生效、次月生效）

### 2.3 账户管理子域（Account Management Subdomain）
**核心职责：** 管理账户信息，作为费用支付和账单管理的载体

**关键业务能力：**
- 账户开立与关闭
- 账户余额管理
- 账户充值与扣费
- 账户关联关系管理（客户-账户、用户-账户）
- 账户授权与权限管理
- 账户冻结与解冻

**业务规则：**
- 账户与客户必须关联
- 支持一个账户关联多个用户（统一付费）
- 支持一个用户关联多个账户（分项付费）
- 账户余额不足时的处理策略
- 账户操作权限控制

### 2.4 产品订购子域（Product Subscription Subdomain）
**核心职责：** 管理用户的产品订购关系和订购生命周期

**关键业务能力：**
- 产品订购（套餐、增值业务）
- 产品退订
- 产品变更
- 订购关系查询
- 订购生效规则处理

**业务规则：**
- 产品订购必须基于有效用户
- 产品互斥关系检查
- 产品依赖关系检查
- 订购生效时间规则

## 三、限界上下文（Bounded Context）定义

### 3.1 客户上下文（Customer Context）

**边界范围：**
- 客户实体及其生命周期
- 客户类型（个人、家庭、政企）
- 客户等级与积分
- 客户关系网络

**统一语言：**
- Customer（客户）
- Individual Customer（公众/个人客户）
- Family Customer（家庭客户）
- Enterprise Customer（政企客户）
- Customer Profile（客户档案）
- Customer Relationship（客户关系）
- Customer Level（客户等级）

**上下文映射：**
- 与用户上下文：开放主机服务（OHS），客户提供查询接口
- 与账户上下文：发布-订阅，客户变更发布事件
- 与订单中心：客户-供应商，接收订单请求

### 3.2 用户上下文（User Context）

**边界范围：**
- 用户实体及其生命周期
- 用户类型（个人用户、群用户）
- 用户状态管理
- 用户产品订购
- SIM卡管理

**统一语言：**
- User（用户）
- Individual User（个人用户）
- Group User（群用户）
- User Status（用户状态）
- Phone Number（号码）
- SIM Card（SIM卡）
- IMSI/ICCID（SIM卡标识）
- Service Package（资费套餐）
- User Activation（用户开通）
- User Suspension（用户停机）

**上下文映射：**
- 与客户上下文：遵奉者（CF），用户依赖客户信息
- 与账户上下文：共享内核（SK），共享费用相关概念
- 与开通中心：防腐层（ACL），隔离开通复杂性

### 3.3 账户上下文（Account Context）

**边界范围：**
- 账户实体及其生命周期
- 账户余额管理
- 账户关联关系
- 充值与扣费记录

**统一语言：**
- Account（账户）
- Account Balance（账户余额）
- Account Recharge（账户充值）
- Account Deduction（账户扣费）
- Payment Account（付费账户）
- Account Relationship（账户关联关系）

**上下文映射：**
- 与客户上下文：遵奉者（CF），账户属于客户
- 与用户上下文：共享内核（SK），共享付费概念
- 与计费中心：客户-供应商，接收计费请求

### 3.4 产品订购上下文（Subscription Context）

**边界范围：**
- 产品订购关系
- 订购生效规则
- 产品变更历史

**统一语言：**
- Subscription（订购）
- Product Offering（产品）
- Service Package（套餐）
- Value Added Service（增值业务）
- Subscription Status（订购状态）
- Effective Time（生效时间）

**上下文映射：**
- 与用户上下文：共享内核（SK），共享用户概念
- 与产商品中心：防腐层（ACL），隔离产品复杂性

## 四、上下文映射图

```
┌─────────────────────────────────────────────────────────┐
│                     外部系统                             │
├──────────────┬──────────────┬──────────────┬───────────┤
│  订单中心     │  产商品中心   │   开通中心    │  计费中心  │
└──────┬───────┴──────┬───────┴──────┬───────┴─────┬─────┘
       │ U/D          │ ACL           │ ACL         │ U/D
       │              │               │             │
┌──────▼──────────────▼───────────────▼─────────────▼─────┐
│              客户中心 (Customer Center)                   │
│  ┌─────────────┐  ┌──────────────┐  ┌─────────────┐    │
│  │客户上下文    │  │  用户上下文   │  │账户上下文    │    │
│  │Customer     │  │  User        │  │Account      │    │
│  │Context      │  │  Context     │  │Context      │    │
│  │             │  │              │  │             │    │
│  │- 客户管理   │  │ - 用户管理   │  │- 账户管理   │    │
│  │- 客户类型   │  │ - 状态管理   │  │- 余额管理   │    │
│  │- 客户等级   │  │ - 资费管理   │  │- 充值扣费   │    │
│  └────┬────────┘  └──────┬───────┘  └──────┬──────┘    │
│       │ OHS              │ CF/SK            │ CF        │
│       │                  │                  │           │
│  ┌────▼──────────────────▼──────────────────▼──────┐   │
│  │           产品订购上下文                          │   │
│  │        Subscription Context                      │   │
│  │        - 产品订购  - 订购变更  - 生效规则        │   │
│  └──────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────┘

图例：
OHS - Open Host Service（开放主机服务）
ACL - Anti-Corruption Layer（防腐层）
CF  - Conformist（遵奉者）
SK  - Shared Kernel（共享内核）
U/D - Upstream/Downstream（上下游）
```

## 五、关键设计决策

### 5.1 为什么将用户管理独立为单独的上下文？
1. **业务复杂度高**：用户管理占90%以上业务量，状态机复杂
2. **生命周期独立**：用户生命周期与客户不完全同步
3. **性能要求高**：高并发场景下需要独立扩展
4. **领域概念清晰**：用户（号码）是独立的领域概念

### 5.2 为什么账户管理需要独立上下文？
1. **计费解耦**：账户作为计费的抽象，隔离复杂的计费逻辑
2. **灵活关联**：支持多种账户-用户关联模式
3. **安全隔离**：涉及资金，需要独立的安全边界
4. **独立演进**：账户系统可能需要接入支付平台等外部系统

### 5.3 上下文之间如何协作？
1. **事件驱动**：使用领域事件进行异步解耦
2. **API调用**：关键同步场景使用RESTful API
3. **共享数据库**：避免跨上下文的数据库JOIN
4. **最终一致性**：接受分布式系统的最终一致性

## 六、总结

本设计基于DDD方法论，将客户中心划分为4个核心限界上下文：
1. **客户上下文**：管理客户档案和关系
2. **用户上下文**：管理用户（号码）全生命周期（核心、高频）
3. **账户上下文**：管理账户和费用
4. **产品订购上下文**：管理产品订购关系

每个上下文具有清晰的边界和职责，通过定义良好的上下文映射模式进行协作，既保证了业务的内聚性，又保证了系统的可扩展性和可维护性。
